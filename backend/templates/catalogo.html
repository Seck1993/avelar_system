{% extends 'base.html' %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h3><i class="fas fa-boxes text-warning"></i> Catálogo de Preços e Estoque</h3>
    <a href="{{ url_for('novo_orcamento') }}" class="btn btn-success fw-bold">
        <i class="fas fa-file-invoice-dollar"></i> CRIAR ORÇAMENTO
    </a>
</div>

<ul class="nav nav-tabs border-secondary mb-4" id="catTab" role="tablist">
    <li class="nav-item">
        <button class="nav-link active text-white bg-dark border-secondary" data-bs-toggle="tab" data-bs-target="#produtos">
            <i class="fas fa-video text-info"></i> Equipamentos & Peças
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link text-white bg-dark border-secondary" data-bs-toggle="tab" data-bs-target="#servicos">
            <i class="fas fa-tools text-warning"></i> Serviços & Mão de Obra
        </button>
    </li>
</ul>

<div class="tab-content">
    
    <div class="tab-pane fade show active" id="produtos">
        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="card-custom border-secondary h-100">
                    <h5 class="text-info mb-3">Novo Equipamento</h5>
                    <form action="{{ url_for('novo_item_catalogo') }}" method="POST">
                        <input type="hidden" name="tipo" value="Produto">
                        
                        <div class="mb-2">
                            <label class="small text-muted">Nome do Item</label>
                            <input type="text" name="item" class="form-control" placeholder="Ex: Câmera Bullet Full HD" required>
                        </div>
                        <div class="row">
                            <div class="col-6 mb-2">
                                <label class="small text-muted">Marca</label>
                                <input type="text" name="marca" class="form-control" placeholder="Intelbras">
                            </div>
                            <div class="col-6 mb-2">
                                <label class="small text-muted">Modelo</label>
                                <input type="text" name="modelo" class="form-control" placeholder="VHD 3220">
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="small text-muted">Especificações Técnicas</label>
                            <textarea name="descricao" class="form-control" rows="2" placeholder="Lente 2.8mm, IR 20m..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-6 mb-2">
                                <label class="small text-muted">Unidade</label>
                                <select name="unidade" class="form-select">
                                    <option value="un">Unidade</option>
                                    <option value="m">Metros</option>
                                    <option value="cx">Caixa</option>
                                    <option value="kg">Kg</option>
                                </select>
                            </div>
                            <div class="col-6 mb-2">
                                <label class="small text-muted">Preço Venda (R$)</label>
                                <input type="number" step="0.01" name="valor" class="form-control text-success fw-bold" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6 mb-2">
                                <label class="small text-muted">Custo Compra (R$)</label>
                                <input type="number" step="0.01" name="custo_compra" class="form-control">
                            </div>
                            <div class="col-6 mb-2">
                                <label class="small text-muted">Add Valor Instalação</label>
                                <input type="number" step="0.01" name="valor_instalacao" class="form-control" placeholder="Opcional">
                            </div>
                        </div>
                        <button class="btn btn-info w-100 fw-bold mt-2">Cadastrar Produto</button>
                    </form>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card-custom p-0" style="max-height: 600px; overflow-y: auto;">
                    <table class="table table-dark table-hover mb-0 align-middle">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Detalhes</th>
                                <th>Preço</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in produtos %}
                            <tr>
                                <td>
                                    <div class="fw-bold">{{ p.item }}</div>
                                    <small class="text-muted">{{ p.marca }} - {{ p.modelo }}</small>
                                </td>
                                <td>
                                    <div class="small text-muted">{{ p.descricao }}</div>
                                    {% if p.valor_instalacao > 0 %}
                                    <span class="badge bg-dark border border-secondary text-muted">Instalação: +R$ {{ p.valor_instalacao }}</span>
                                    {% endif %}
                                </td>
                                <td class="text-success fw-bold">R$ {{ "%.2f"|format(p.valor) }} /{{ p.unidade }}</td>
                                <td>
                                    <a href="{{ url_for('excluir_item_catalogo', id=p.id) }}" class="btn btn-sm btn-outline-danger border-0" onclick="return confirm('Excluir?')"><i class="fas fa-trash"></i></a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-pane fade" id="servicos">
        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="card-custom border-secondary">
                    <h5 class="text-warning mb-3">Novo Serviço</h5>
                    <form action="{{ url_for('novo_item_catalogo') }}" method="POST">
                        <input type="hidden" name="tipo" value="Serviço">
                        <input type="hidden" name="unidade" value="un">
                        
                        <div class="mb-3">
                            <label class="small text-muted">Nome do Serviço</label>
                            <input type="text" name="item" class="form-control" placeholder="Ex: Instalação Ponto de Rede" required>
                        </div>
                        <div class="mb-3">
                            <label class="small text-muted">Descrição do que será feito</label>
                            <textarea name="descricao" class="form-control" rows="3" placeholder="Passagem de cabo, crimpagem e testes..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="small text-muted">Valor Base (R$)</label>
                            <input type="number" step="0.01" name="valor" class="form-control text-warning fw-bold" required>
                        </div>
                        <button class="btn btn-warning text-dark w-100 fw-bold">Cadastrar Serviço</button>
                    </form>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card-custom p-0">
                    <table class="table table-dark table-hover mb-0 align-middle">
                        <thead>
                            <tr>
                                <th>Serviço</th>
                                <th>Descrição</th>
                                <th>Valor Base</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for s in servicos %}
                            <tr>
                                <td class="fw-bold">{{ s.item }}</td>
                                <td class="text-muted small">{{ s.descricao }}</td>
                                <td class="text-warning fw-bold">R$ {{ "%.2f"|format(s.valor) }}</td>
                                <td>
                                    <a href="{{ url_for('excluir_item_catalogo', id=s.id) }}" class="btn btn-sm btn-outline-danger border-0" onclick="return confirm('Excluir?')"><i class="fas fa-trash"></i></a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}